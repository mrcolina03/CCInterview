<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de CV - ccInterview</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/estilos.css') }}">
    <style>
        /*Pantalla de carga*/
        .pantalla-carga {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #111111;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }

        .oculto {
            display: none;
        }

        .loader-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lottie-anim {
            width: 180px;
            height: 180px;
        }

        .texto-carga {
            color: #000;
            font-size: 1.5rem;
            margin-top: 20px;
            font-weight: bold;
            animation: parpadeo 1.5s infinite;
        }

        @keyframes parpadeo {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.4;
            }
        }

        /* Estilos espec√≠ficos para el formulario CV */
        .cv-container {
            min-height: 100vh;
            background: var(--bg-primary);
            padding: var(--space-xl) var(--space-md);
        }

        .cv-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
            position: relative;
        }

        .home-button-top {
            position: absolute;
            top: 0;
            left: 0;
        }

        .cv-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        .back-btn {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 1.1rem;
            transition: color var(--transition);
        }

        .cv-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .cv-form {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .cv-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
        }

        .cv-section {
            margin-bottom: var(--space-xl);
            padding: var(--space-lg);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            position: relative;
        }

        .cv-section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .dynamic-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            position: relative;
        }

        .dynamic-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--accent-green);
            border-radius: var(--radius-sm);
        }

        .add-button {
            background: var(--bg-primary);
            color: var(--accent-blue);
            border: 2px dashed var(--accent-blue);
            border-radius: var(--radius);
            padding: var(--space-md) var(--space-lg);
            cursor: pointer;
            transition: all var(--transition);
            font-weight: 500;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
        }

        .add-button:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--accent-purple);
            color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .cv-form .form-input {
            margin-bottom: var(--space-md);
        }

        .cv-form textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        .submit-section {
            text-align: center;
            margin-top: var(--space-2xl);
            padding-top: var(--space-xl);
            border-top: 1px solid var(--border-color);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: var(--space-lg) var(--space-2xl);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--transition-slow);
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .submit-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }

        .form-row-full {
            grid-column: 1 / -1;
        }

        /* Indicador de campo obligatorio */
        .required-indicator {
            color: var(--error-color);
            font-weight: bold;
            margin-left: var(--space-xs);
        }

        .section-required {
            font-size: 0.9rem;
            color: var(--error-color);
            font-style: italic;
            margin-bottom: var(--space-md);
        }

        .agr-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 100px;
        }

        /* Estilos para combo select personalizado */
        .custom-select-container {
            position: relative;
            margin-bottom: var(--space-md);
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background: black;
        }

        .select-header {
            padding: var(--space-sm) var(--space-md);
            background: black;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: var(--text-primary);
        }

        .select-header:hover {
            background: #34333322;
        }

        .select-arrow {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .select-arrow.open {
            transform: rotate(180deg);
        }

        .select-search {
            padding: var(--space-sm);
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            padding: var(--space-sm);
            border: 1px solid #000000;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            outline: none;
            color: var(--text-primary);
            background-color: #000000;
        }

        .search-input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.1);
        }

        .select-options {
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .select-options.show {
            display: block;
        }

        .select-option {
            padding: var(--space-sm) var(--space-md);
            cursor: pointer;
            border-bottom: 1px solid #454444;
            transition: background-color 0.2s ease;
            font-size: 0.9rem;
        }

        .select-option:hover {
            background: #5d5d5d;
        }

        .select-option:last-child {
            border-bottom: none;
        }

        .select-option.hidden {
            display: none;
        }

        /* Tags container mejorado */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            margin-top: var(--space-sm);
            padding: var(--space-sm);
            background: #000000;
            border: 1px solid #000000;
            border-radius: var(--radius);
            min-height: 50px;
            align-items: flex-start;
        }

        .tags-container:empty::before {
            content: 'No hay elementos seleccionados';
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            height: 36px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            background: var(--accent-blue);
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .remove-tag {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            padding: 0;
            margin-left: var(--space-xs);
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .remove-tag:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Estilos para las opciones "No tengo" */
        .no-option-container {
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: #000000;
            border: 1px solid #e9ecef;
            border-radius: var(--radius);
        }

        .no-option-checkbox {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.95rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .no-option-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .section-content {
            transition: opacity 0.3s ease, height 0.3s ease;
        }

        .section-content.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cv-container {
                padding: var(--space-lg) var(--space-sm);
            }

            .cv-form {
                padding: var(--space-lg);
            }

            .cv-title {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .lottie-anim {
                width: 120px;
                height: 120px;
            }

            .texto-carga {
                font-size: 1.2rem;
            }
        }
    </style>
    <script>
        function addSection(sectionId, templateId) {
            const container = document.getElementById(sectionId);
            const template = document.getElementById(templateId);
            const clone = template.content.cloneNode(true);
            container.appendChild(clone);
        }

        function toggleSection(checkboxId, sectionId) {
            const checkbox = document.getElementById(checkboxId);
            const section = document.getElementById(sectionId);
            const inputs = section.querySelectorAll('input, textarea, select');
            
            if (checkbox.checked) {
                section.classList.add('disabled');
                // Deshabilitar todos los inputs y remover required
                inputs.forEach(input => {
                    input.disabled = true;
                    input.removeAttribute('required');
                });
            } else {
                section.classList.remove('disabled');
                // Habilitar todos los inputs y restaurar required donde corresponda
                inputs.forEach(input => {
                    input.disabled = false;
                    // Solo restaurar required si est√° en un template que lo necesita
                    if (input.hasAttribute('data-required')) {
                        input.setAttribute('required', '');
                    }
                });
            }
        }
    </script>
</head>
<body>
    {% include "_navbar.html" %}
    <div class="cv-container">
        <div class="cv-header">
            <h1 class="cv-title">Formulario de CV</h1>
            <p class="cv-subtitle">Completa tu informaci√≥n profesional para ccInterview</p>
        </div>

        <form class="cv-form" action="/cv/submit" method="post">
            <!-- INFORMACI√ìN PERSONAL -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">üë§</span>
                    Informaci√≥n Personal
                </h2>
                <div class="form-group">
                    <input type="text" name="nombre" class="form-input" placeholder="Nombre completo" required>
                </div>
            </div>

            <!-- EXPERIENCIA PROFESIONAL -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">üíº</span>
                    Experiencia Profesional
                </h2>
                
                <div class="no-option-container">
                    <label class="no-option-checkbox">
                        <input type="checkbox" id="no-experiencia" name="no_experiencia" onchange="toggleSection('no-experiencia', 'experiencia-content')">
                        <span>üìù No tengo experiencia todav√≠a</span>
                    </label>
                </div>

                <div id="experiencia-content" class="section-content">
                    <div id="experienciaContainer"></div>
                    <button type="button" class="add-button" onclick="addSection('experienciaContainer', 'experienciaTemplate')">
                        <span>+</span> A√±adir experiencia
                    </button>
                </div>
            </div>

            <template id="experienciaTemplate">
                <div class="dynamic-section">
                    <div class="form-row">
                        <input type="text" name="exp_puesto" class="form-input" placeholder="Puesto" data-required>
                        <input type="text" name="exp_empresa" class="form-input" placeholder="Empresa" data-required>
                    </div>
                    <div class="form-row">
                        <input type="date" name="exp_fecha_inicio" class="form-input" placeholder="Fecha de inicio" data-required>
                        <input type="date" name="exp_fecha_fin" class="form-input" placeholder="Fecha de fin" data-required>
                    </div>
                    <div class="form-group">
                        <textarea name="exp_descripcion" class="form-input" placeholder="Descripci√≥n de responsabilidades y logros" data-required></textarea>
                    </div>
                </div>
            </template>

            <!-- CERTIFICACIONES -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">üèÜ</span>
                    Certificaciones
                </h2>
                
                <div class="no-option-container">
                    <label class="no-option-checkbox">
                        <input type="checkbox" id="no-certificaciones" name="no_certificaciones" onchange="toggleSection('no-certificaciones', 'certificaciones-content')">
                        <span>üéØ No tengo certificaciones todav√≠a</span>
                    </label>
                </div>

                <div id="certificaciones-content" class="section-content">
                    <div id="certificacionesContainer"></div>
                    <button type="button" class="add-button" onclick="addSection('certificacionesContainer', 'certificacionTemplate')">
                        <span>+</span> A√±adir certificaci√≥n
                    </button>
                </div>
            </div>

            <template id="certificacionTemplate">
                <div class="dynamic-section">
                    <div class="form-row">
                        <input type="text" name="cert_nombre" class="form-input" placeholder="Nombre de certificaci√≥n" data-required>
                        <input type="text" name="cert_emisor" class="form-input" placeholder="Emitido por" data-required>
                    </div>
                </div>
            </template>

            <!-- IDIOMAS -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">üåç</span>
                    Idiomas<span class="required-indicator">*</span>
                </h2>
                <p class="section-required">* Al menos un idioma es obligatorio</p>
                <div id="idiomasContainer"></div>
                <button type="button" class="add-button" onclick="addSection('idiomasContainer', 'idiomaTemplate')">
                    <span>+</span> A√±adir idioma adicional
                </button>
            </div>

            <template id="idiomaTemplate">
                <div class="dynamic-section">
                    <div class="form-row">
                        <input type="text" name="idioma_nombre" class="form-input" placeholder="Idioma" required>
                        <input type="text" name="idioma_nivel" class="form-input" placeholder="Nivel (ej: Intermedio, Avanzado, Nativo)" required>
                    </div>
                </div>
            </template>

            <!-- HABILIDADES T√âCNICAS -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">‚ö°</span>
                    Habilidades T√©cnicas
                </h2>

                <!-- Lenguajes -->
                <div class="form-group">
                    <label>Lenguajes de programaci√≥n</label>
                    <div class="custom-select-container">
                        <div class="custom-select" id="select-lenguajes">
                            <div class="select-header" onclick="toggleSelect('lenguajes')">
                                <span>Seleccionar lenguajes de programaci√≥n</span>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="select-search">
                                <input type="text" class="search-input" placeholder="Buscar lenguaje..." onkeyup="filterOptions('lenguajes', this.value)">
                            </div>
                            <div class="select-options" id="options-lenguajes"></div>
                        </div>
                    </div>
                    <div id="tags-lenguajes" class="tags-container"></div>
                    <input type="hidden" name="lenguajes" id="hidden-lenguajes" required>
                </div>

                <!-- Frameworks -->
                <div class="form-group">
                    <label>Frameworks</label>
                    <div class="custom-select-container">
                        <div class="custom-select" id="select-frameworks">
                            <div class="select-header" onclick="toggleSelect('frameworks')">
                                <span>Seleccionar frameworks</span>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="select-search">
                                <input type="text" class="search-input" placeholder="Buscar framework..." onkeyup="filterOptions('frameworks', this.value)">
                            </div>
                            <div class="select-options" id="options-frameworks"></div>
                        </div>
                    </div>
                    <div id="tags-frameworks" class="tags-container"></div>
                    <input type="hidden" name="frameworks" id="hidden-frameworks">
                </div>

                <!-- Bases de Datos -->
                <div class="form-group">
                    <label>Bases de datos</label>
                    <div class="custom-select-container">
                        <div class="custom-select" id="select-bases">
                            <div class="select-header" onclick="toggleSelect('bases')">
                                <span>Seleccionar bases de datos</span>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="select-search">
                                <input type="text" class="search-input" placeholder="Buscar base de datos..." onkeyup="filterOptions('bases', this.value)">
                            </div>
                            <div class="select-options" id="options-bases"></div>
                        </div>
                    </div>
                    <div id="tags-bases" class="tags-container"></div>
                    <input type="hidden" name="bases_datos" id="hidden-bases">
                </div>

                <!-- Herramientas -->
                <div class="form-group">
                    <label>Herramientas</label>
                    <div class="custom-select-container">
                        <div class="custom-select" id="select-herramientas">
                            <div class="select-header" onclick="toggleSelect('herramientas')">
                                <span>Seleccionar herramientas</span>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <div class="select-search">
                                <input type="text" class="search-input" placeholder="Buscar herramienta..." onkeyup="filterOptions('herramientas', this.value)">
                            </div>
                            <div class="select-options" id="options-herramientas"></div>
                        </div>
                    </div>
                    <div id="tags-herramientas" class="tags-container"></div>
                    <input type="hidden" name="herramientas" id="hidden-herramientas">
                </div>

                <script>
                    // Datos ampliados para cada categor√≠a
                    const skillsData = {
                        lenguajes: [
                            'Python', 'JavaScript', 'Java', 'C#', 'C++', 'C', 'Go', 'Rust', 'Ruby', 'PHP',
                            'TypeScript', 'Swift', 'Kotlin', 'Scala', 'R', 'MATLAB', 'Perl', 'Lua', 'Dart',
                            'Objective-C', 'Visual Basic', 'F#', 'Clojure', 'Haskell', 'Erlang', 'Elixir',
                            'Assembly', 'COBOL', 'Fortran', 'Pascal', 'Delphi', 'ActionScript', 'CoffeeScript',
                            'Julia', 'Groovy', 'PowerShell', 'Bash', 'SQL', 'PL/SQL', 'T-SQL'
                        ],
                        frameworks: [
                            'React', 'Vue.js', 'Angular', 'Django', 'Flask', 'FastAPI', 'Spring Boot', 'Express.js',
                            'Node.js', 'Laravel', 'CodeIgniter', 'Symfony', 'Ruby on Rails', 'ASP.NET', 'ASP.NET Core',
                            '.NET Framework', 'Blazor', 'Next.js', 'Nuxt.js', 'Svelte', 'SvelteKit', 'Gatsby',
                            'Ember.js', 'Backbone.js', 'jQuery', 'Bootstrap', 'Tailwind CSS', 'Bulma', 'Foundation',
                            'Materialize', 'Semantic UI', 'Ant Design', 'Material-UI', 'Chakra UI', 'Styled Components',
                            'Sass', 'Less', 'Stylus', 'PostCSS', 'Webpack', 'Vite', 'Parcel', 'Rollup'
                        ],
                        bases: [
                            'MySQL', 'PostgreSQL', 'MongoDB', 'SQLite', 'Redis', 'MariaDB', 'Oracle Database',
                            'Microsoft SQL Server', 'IBM DB2', 'Cassandra', 'CouchDB', 'Neo4j', 'InfluxDB',
                            'Amazon DynamoDB', 'Firebase Firestore', 'Elasticsearch', 'Apache Solr', 'Memcached',
                            'Amazon RDS', 'Amazon Aurora', 'Google Cloud SQL', 'Azure SQL Database', 'Supabase',
                            'PlanetScale', 'FaunaDB', 'RethinkDB', 'TimescaleDB', 'ClickHouse', 'Snowflake',
                            'BigQuery', 'Amazon Redshift', 'Apache Spark', 'Apache Kafka', 'RabbitMQ'
                        ],
                        herramientas: [
                            'Git', 'GitHub', 'GitLab', 'Bitbucket', 'Docker', 'Kubernetes', 'Jenkins', 'Travis CI',
                            'CircleCI', 'GitLab CI/CD', 'GitHub Actions', 'Azure DevOps', 'VS Code', 'IntelliJ IDEA',
                            'Eclipse', 'Sublime Text', 'Atom', 'Vim', 'Emacs', 'WebStorm', 'PyCharm', 'Android Studio',
                            'Xcode', 'Visual Studio', 'Postman', 'Insomnia', 'Swagger', 'Figma', 'Adobe XD',
                            'Sketch', 'Photoshop', 'Illustrator', 'Slack', 'Discord', 'Zoom', 'Microsoft Teams',
                            'Jira', 'Trello', 'Asana', 'Notion', 'Confluence', 'AWS', 'Google Cloud Platform',
                            'Microsoft Azure', 'Heroku', 'Vercel', 'Netlify', 'DigitalOcean', 'Terraform',
                            'Ansible', 'Vagrant', 'VMware', 'VirtualBox', 'Nginx', 'Apache', 'Linux', 'Ubuntu',
                            'CentOS', 'Windows Server', 'macOS', 'Chrome DevTools', 'Firefox DevTools'
                        ]
                    };

                    const selectedSkills = {
                        lenguajes: new Set(),
                        frameworks: new Set(),
                        bases: new Set(),
                        herramientas: new Set()
                    };

                    function initializeSkillSelectors() {
                        Object.keys(skillsData).forEach(category => {
                            populateOptions(category);
                            updateTags(category);
                        });
                    }

                    function populateOptions(category) {
                        const optionsContainer = document.getElementById(`options-${category}`);
                        optionsContainer.innerHTML = '';
                        
                        skillsData[category].forEach(skill => {
                            const option = document.createElement('div');
                            option.className = 'select-option';
                            option.textContent = skill;
                            option.onclick = () => selectSkill(category, skill);
                            optionsContainer.appendChild(option);
                        });
                    }

                    function toggleSelect(category) {
                        const selectElement = document.getElementById(`select-${category}`);
                        const options = document.getElementById(`options-${category}`);
                        const arrow = selectElement.querySelector('.select-arrow');
                        
                        // Cerrar otros selects abiertos
                        document.querySelectorAll('.select-options.show').forEach(el => {
                            if (el !== options) {
                                el.classList.remove('show');
                                el.parentElement.querySelector('.select-arrow').classList.remove('open');
                            }
                        });
                        
                        options.classList.toggle('show');
                        arrow.classList.toggle('open');
                    }

                    function filterOptions(category, searchTerm) {
                        const options = document.querySelectorAll(`#options-${category} .select-option`);
                        const term = searchTerm.toLowerCase();
                        
                        options.forEach(option => {
                            const text = option.textContent.toLowerCase();
                            if (text.includes(term)) {
                                option.classList.remove('hidden');
                            } else {
                                option.classList.add('hidden');
                            }
                        });
                    }

                    function selectSkill(category, skill) {
                        if (!selectedSkills[category].has(skill)) {
                            selectedSkills[category].add(skill);
                            updateTags(category);
                        }
                        
                        // Cerrar el select despu√©s de seleccionar
                        const options = document.getElementById(`options-${category}`);
                        const arrow = document.querySelector(`#select-${category} .select-arrow`);
                        options.classList.remove('show');
                        arrow.classList.remove('open');
                        
                        // Limpiar b√∫squeda
                        const searchInput = document.querySelector(`#select-${category} .search-input`);
                        searchInput.value = '';
                        filterOptions(category, '');
                    }

                    function updateTags(category) {
                        const container = document.getElementById(`tags-${category}`);
                        const hiddenInput = document.getElementById(`hidden-${category}`);
                        
                        container.innerHTML = '';
                        
                        selectedSkills[category].forEach(skill => {
                            const tag = document.createElement('span');
                            tag.className = 'tag';
                            tag.innerHTML = `${skill} <button type="button" class="remove-tag" onclick="removeSkill('${category}', '${skill}')">&times;</button>`;
                            container.appendChild(tag);
                        });
                        
                        hiddenInput.value = Array.from(selectedSkills[category]).join(',');
                    }

                    function removeSkill(category, skill) {
                        selectedSkills[category].delete(skill);
                        updateTags(category);
                    }

                    // Cerrar selects al hacer clic fuera
                    document.addEventListener('click', function(event) {
                        if (!event.target.closest('.custom-select')) {
                            document.querySelectorAll('.select-options.show').forEach(el => {
                                el.classList.remove('show');
                                el.parentElement.querySelector('.select-arrow').classList.remove('open');
                            });
                        }
                    });
                </script>
            </div>

            <!-- ESTUDIOS -->
            <div class="cv-section">
                <h2 class="cv-section-title">
                    <span class="section-icon">üéì</span>
                    Estudios<span class="required-indicator">*</span>
                </h2>
                <p class="section-required">* Al menos un estudio es obligatorio</p>
                <div id="estudiosContainer"></div>
                <button type="button" class="add-button" onclick="addSection('estudiosContainer', 'estudioTemplate')">
                    <span>+</span> A√±adir estudio adicional
                </button>
            </div>

            <template id="estudioTemplate">
                <div class="dynamic-section">
                    <div class="form-row">
                        <input type="text" name="estudio_institucion" class="form-input" placeholder="Instituci√≥n" required>
                        <input type="text" name="estudio_titulo" class="form-input" placeholder="T√≠tulo obtenido" required>
                    </div>
                    <div class="form-row">
                        <input type="date" name="estudio_fecha_inicio" class="form-input" placeholder="Fecha de inicio" required>
                        <input type="date" name="estudio_fecha_fin" class="form-input" placeholder="Fecha de fin" required>
                    </div>
                </div>
            </template>

            <div class="submit-section">
                <button type="submit" class="submit-btn">
                    Guardar CV
                </button>
            </div>
        </form>
    </div>

    <!-- Pantalla de carga -->
    <div id="pantalla-carga" class="pantalla-carga oculto">
        <div class="loader-content">
            <div id="lottie" class="lottie-anim"></div>
            <p class="texto-carga">PROCESANDO...</p>
        </div>
    </div>

    <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar selectors de habilidades
            initializeSkillSelectors();
            
            // Agregar el primer idioma y estudio autom√°ticamente
            addSection('idiomasContainer', 'idiomaTemplate');
            addSection('estudiosContainer', 'estudioTemplate');

            // Inicializar animaci√≥n Lottie
            lottie.loadAnimation({
                container: document.getElementById("lottie"),
                renderer: "svg",
                loop: true,
                autoplay: true,
                path: "{{ url_for('static', path='animations/cargando.json') }}"
            });

            // Captura de env√≠o del formulario
            const form = document.querySelector(".cv-form");
            const loader = document.getElementById("pantalla-carga");

            form.addEventListener("submit", function (e) {
                // Evita m√∫ltiples env√≠os
                if (form.dataset.enviando === "true") {
                    e.preventDefault();
                    return;
                }

                // Validaci√≥n adicional antes de mostrar carga
                const lenguajes = document.getElementById('hidden-lenguajes').value;
                if (!lenguajes) {
                    alert('Debes seleccionar al menos un lenguaje de programaci√≥n');
                    e.preventDefault();
                    return;
                }

                // Validar experiencia o checkbox
                const noExperiencia = document.getElementById('no-experiencia').checked;
                const hayExperiencia = document.querySelectorAll('#experienciaContainer .dynamic-section').length > 0;
                
                if (!noExperiencia && !hayExperiencia) {
                    alert('Debes agregar experiencia o marcar "No tengo experiencia todav√≠a"');
                    e.preventDefault();
                    return;
                }

                // Validar certificaciones o checkbox
                const noCertificaciones = document.getElementById('no-certificaciones').checked;
                const hayCertificaciones = document.querySelectorAll('#certificacionesContainer .dynamic-section').length > 0;
                
                if (!noCertificaciones && !hayCertificaciones) {
                    alert('Debes agregar certificaciones o marcar "No tengo certificaciones todav√≠a"');
                    e.preventDefault();
                    return;
                }

                form.dataset.enviando = "true"; // Marca que ya se est√° enviando
                loader.classList.remove("oculto"); // Muestra pantalla de carga
                
                // Deshabilitar el bot√≥n de env√≠o
                const submitBtn = form.querySelector('.submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Guardando...';
            });
        });
    </script>
</body>
</html>
